<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Pharmyrus</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 2rem; color: #1f2937; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* LOGO */
        .logo-container { background: white; padding: 1.5rem 2rem; border-radius: 1rem 1rem 0 0; margin-bottom: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 1rem; }
        .logo { font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo-tagline { color: #6b7280; font-size: 0.875rem; font-weight: 500; }
        
        /* LOADING */
        .loading-state { background: white; padding: 3rem; border-radius: 1rem; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .loading-state.hidden { display: none; }
        .spinner { width: 60px; height: 60px; border: 4px solid #e5e7eb; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ERROR */
        .error-state { background: white; padding: 3rem; border-radius: 1rem; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .error-state.hidden { display: none; }
        .error-state h2 { color: #dc2626; font-size: 1.5rem; margin-bottom: 1rem; }
        
        /* HEADER */
        .header { background: white; padding: 2rem; border-radius: 0 0 1rem 1rem; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header h1 { color: #1f2937; font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
        .header .subtitle { color: #6b7280; font-size: 1.125rem; margin-bottom: 1rem; }
        .info-pills { display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .pill { display: inline-flex; align-items: center; padding: 0.5rem 1rem; background: #f3f4f6; border-radius: 999px; font-size: 0.875rem; color: #374151; }
        .pill strong { color: #1f2937; margin-right: 0.25rem; }
        .header-actions { display: flex; gap: 1rem; flex-wrap: wrap; }
        
        /* BUTTONS */
        .btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: #667eea; color: white; border: none; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; }
        .btn:hover { background: #5568d3; transform: translateY(-1px); }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        
        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card .value { font-size: 2.5rem; font-weight: 700; color: #667eea; margin-bottom: 0.5rem; }
        .stat-card .value.small { font-size: 1.67rem; } /* 33% menor */
        .stat-card .label { color: #6b7280; font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem; }
        .stat-card .info { color: #9ca3af; font-size: 0.75rem; }
        
        /* REPORT - 2x2 */
        .report-section { background: white; padding: 2rem; border-radius: 1rem; margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .report-section h3 { color: #1f2937; font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; }
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .report-item h4 { color: #1f2937; font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; }
        .report-item p { color: #4b5563; font-size: 0.9375rem; line-height: 1.6; }
        
        /* SEARCH */
        .search-section { background: white; padding: 1.5rem; border-radius: 1rem; margin-bottom: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .search-wrapper { position: relative; }
        .search-input { width: 100%; padding: 1rem 1rem 1rem 3rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem; }
        .search-input:focus { outline: none; border-color: #667eea; }
        .search-icon { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 1.25rem; }
        .autocomplete-results { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #e5e7eb; border-top: none; border-radius: 0 0 0.5rem 0.5rem; max-height: 300px; overflow-y: auto; z-index: 100; display: none; }
        .autocomplete-results.show { display: block; }
        .autocomplete-item { padding: 0.75rem 1rem; cursor: pointer; border-bottom: 1px solid #f3f4f6; }
        .autocomplete-item:hover { background: #f9fafb; }
        
        /* FILTERS - 3 POR LINHA */
        .filters-bar { background: white; padding: 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .filters-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem; }
        .filter-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .filter-group label { font-weight: 600; color: #374151; font-size: 0.875rem; }
        .filter-group select { padding: 0.5rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 0.875rem; color: #374151; background: white; cursor: pointer; }
        .filter-group select:focus { outline: none; border-color: #667eea; }
        .filter-actions { display: flex; gap: 1rem; justify-content: flex-end; }
        
        /* TABLE */
        .table-container { background: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .table-header h3 { color: #1f2937; font-size: 1.25rem; font-weight: 700; }
        .table-wrapper { overflow-x: auto; border-radius: 0.5rem; border: 1px solid #e5e7eb; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f9fafb; position: sticky; top: 0; z-index: 10; }
        th { padding: 1rem; text-align: left; font-weight: 600; color: #374151; font-size: 0.875rem; border-bottom: 2px solid #e5e7eb; }
        td { padding: 1rem; border-bottom: 1px solid #e5e7eb; font-size: 0.875rem; color: #374151; }
        tbody tr { cursor: pointer; transition: background 0.2s; }
        tbody tr:hover { background: #f9fafb; }
        
        /* BADGES */
        .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; }
        .badge-alta { background: #fee2e2; color: #991b1b; }
        .badge-media { background: #fef3c7; color: #92400e; }
        .badge-baixa { background: #dbeafe; color: #1e40af; }
        .badge-tipo { background: #f3f4f6; color: #374151; }
        
        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 1rem; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; max-width: 800px; max-height: 90vh; overflow-y: auto; width: 100%; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb; }
        .modal-header h2 { color: #1f2937; font-size: 1.25rem; font-weight: 700; flex: 1; }
        .modal-close { background: #e5e7eb; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; }
        .modal-close:hover { background: #d1d5db; }
        .modal-body { color: #4b5563; line-height: 1.6; }
        .detail-item { margin-bottom: 1.5rem; }
        .detail-item strong { color: #1f2937; display: block; margin-bottom: 0.5rem; font-size: 0.875rem; text-transform: uppercase; }
        
        .hidden { display: none !important; }
        code { background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.875rem; }
        
        @media (max-width: 768px) {
            body { padding: 1rem; }
            .stats-grid, .report-grid, .filters-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="loadingState" class="loading-state">
            <div class="spinner"></div>
            <h2>Carregando...</h2>
        </div>
        <div id="errorState" class="error-state hidden">
            <h2>‚ùå Erro</h2>
            <p id="errorMessage"></p>
            <button class="btn" onclick="window.location.href='index.html'">Nova Busca</button>
        </div>
        <div id="dashboardContent" class="hidden">
            <div class="logo-container">
                <div>
                    <div class="logo">PHARMYRUS</div>
                    <div class="logo-tagline">Intelig√™ncia de Patentes Farmac√™uticas</div>
                </div>
            </div>
            <div class="header">
                <h1 id="dashboardTitle">Dashboard</h1>
                <p class="subtitle" id="dashboardSubtitle">An√°lise de Patentes</p>
                <div class="info-pills">
                    <span class="pill"><strong>Mol√©cula:</strong> <span id="moleculeName">-</span></span>
                    <span class="pill"><strong>Nome Comercial:</strong> <span id="brandName">-</span></span>
                    <span class="pill"><strong>Classe:</strong> <span id="therapeuticClass">-</span></span>
                </div>
                <div class="header-actions">
                    <button class="btn" onclick="window.print()">üì• Exportar</button>
                    <button class="btn btn-secondary" id="btnNewSearch">üîç Nova Busca</button>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="value" id="totalPatentes">0</div>
                    <div class="label">Total de Patentes</div>
                    <div class="info" id="fontesInfo">-</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="anosProtecao">0</div>
                    <div class="label">Anos de Prote√ß√£o</div>
                    <div class="info">Restantes</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="altaAmeaca">0</div>
                    <div class="label">Alta Amea√ßa</div>
                    <div class="info">Cr√≠ticas</div>
                </div>
                <div class="stat-card">
                    <div class="value small" id="titularDominante">-</div>
                    <div class="label">Titular Principal</div>
                    <div class="info" id="concentracaoInfo">-</div>
                </div>
            </div>
            <div class="report-section">
                <h3>üìä Relat√≥rio Executivo</h3>
                <div class="report-grid">
                    <div class="report-item">
                        <h4>üìã Panorama Geral</h4>
                        <p id="panoramaGeral">-</p>
                    </div>
                    <div class="report-item">
                        <h4>üè¢ Titular Dominante</h4>
                        <p id="titularDominanteDesc">-</p>
                    </div>
                    <div class="report-item">
                        <h4>üöß Barreiras Cr√≠ticas</h4>
                        <p id="barreirasCriticas">-</p>
                    </div>
                    <div class="report-item">
                        <h4>üí° Janelas de Oportunidade</h4>
                        <p id="janelasOportunidade">-</p>
                    </div>
                </div>
            </div>
            <div class="search-section">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" class="search-input" placeholder="Buscar...">
                    <div id="autocompleteResults" class="autocomplete-results"></div>
                </div>
            </div>
            <div class="filters-bar">
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filtroFonte">Fonte:</label>
                        <select id="filtroFonte"><option value="">Todas</option><option value="INPI">INPI</option><option value="EPO">EPO</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroPais">Pa√≠s:</label>
                        <select id="filtroPais"><option value="">Todos</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroAno">Ano:</label>
                        <select id="filtroAno"><option value="">Todos</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroTitular">Titular:</label>
                        <select id="filtroTitular"><option value="">Todos</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroTipo">Tipo:</label>
                        <select id="filtroTipo"><option value="">Todos</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroAmeaca">Amea√ßa:</label>
                        <select id="filtroAmeaca"><option value="">Todos</option><option value="Alta">Alta</option><option value="M√©dia">M√©dia</option><option value="Baixa">Baixa</option></select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-secondary" id="btnClearFilters">üîÑ Limpar</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <h3>üî¨ Patentes</h3>
                    <span id="resultsCount" style="color: #6b7280; font-size: 0.875rem;">0</span>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>N√∫mero</th>
                                <th>T√≠tulo</th>
                                <th>Titular</th>
                                <th>Pa√≠s</th>
                                <th>Ano</th>
                                <th>Tipo</th>
                                <th>Amea√ßa</th>
                            </tr>
                        </thead>
                        <tbody id="patentsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="patentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Detalhes</h2>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
    <script>
console.log('Dashboard v10');
const State = {allPatents: [], filteredPatents: [], filters: {search:'',fonte:'',pais:'',ano:'',titular:'',tipo:'',ameaca:''}, unique: {paises:[],anos:[],titulares:[],tipos:[]}};
const Utils = {
    safe(v) {
        if(!v) return '';
        if(typeof v === 'object') return Array.isArray(v) ? v.map(x=>this.safe(x)).join(', ') : '';
        let s = String(v);
        return s.includes('[object Object]') ? '' : s.trim();
    },
    trunc(t,n=80) { const s=this.safe(t); return !s?'':s.length<=n?s:s.substring(0,n)+'...'; },
    norm(t) { return this.safe(t).toLowerCase().normalize('NFD').replace(/[ÃÄ-ÕØ]/g,''); }
};
const Loader = {
    async load() {
        const d = localStorage.getItem('patentAnalysis');
        if(!d) throw new Error('Nenhum dado');
        const p = JSON.parse(d);
        const data = Array.isArray(p) && p[0] && p[0].output ? JSON.parse(p[0].output) : (Array.isArray(p)?p[0]:p);
        if(!data.patentes) throw new Error('Campo patentes n√£o encontrado');
        State.allPatents = data.patentes;
        this.extractUnique();
        return data;
    },
    extractUnique() {
        const paises=new Set(), anos=new Set(), titulares=new Set(), tipos=new Set();
        State.allPatents.forEach(p=>{
            const pais=p.pais||p.country; if(pais) paises.add(pais);
            const ano=p.ano_deposito||p.ano; if(ano) anos.add(ano);
            const tit=Utils.safe(p.applicant); if(tit) titulares.add(tit);
            const tipo=p.tipo_barreira||p.tipo_patente; if(tipo) tipos.add(tipo);
        });
        State.unique = {
            paises: Array.from(paises).sort(),
            anos: Array.from(anos).sort((a,b)=>b-a),
            titulares: Array.from(titulares).sort(),
            tipos: Array.from(tipos).sort()
        };
    }
};
const Render = {
    dash(data) {
        const m=data.meta||{}, s=data.estatisticas||{}, k=data.metricas_chave||{}, r=data.relatorio_executivo||{};
        document.getElementById('dashboardTitle').textContent='Dashboard - '+(m.nome_comercial||'Patentes');
        document.getElementById('dashboardSubtitle').textContent=`${m.molecula||''} | ${m.classe_terapeutica||''}`;
        document.getElementById('moleculeName').textContent=m.molecula||'-';
        document.getElementById('brandName').textContent=m.nome_comercial||'-';
        document.getElementById('therapeuticClass').textContent=m.classe_terapeutica||'-';
        document.getElementById('totalPatentes').textContent=s.total_patentes||0;
        const f=s.por_fonte||{}; document.getElementById('fontesInfo').textContent=`INPI: ${f.INPI||0} | EPO: ${f.EPO||0}`;
        document.getElementById('anosProtecao').textContent=k.anos_protecao_restantes||0;
        document.getElementById('altaAmeaca').textContent=k.patentes_alta_ameaca||0;
        const t=s.top_titulares||[]; if(t.length>0) {
            document.getElementById('titularDominante').textContent=Utils.trunc(t[0].titular||'-',20);
            document.getElementById('concentracaoInfo').textContent=(k.concentracao_titular||0)+'%';
        } else {
            document.getElementById('titularDominante').textContent='N/A';
        }
        document.getElementById('panoramaGeral').textContent=r.panorama_geral||'-';
        document.getElementById('titularDominanteDesc').textContent=r.titular_dominante||'-';
        document.getElementById('barreirasCriticas').textContent=r.barreiras_criticas||'-';
        document.getElementById('janelasOportunidade').textContent=r.janelas_oportunidade||'-';
        this.filters();
        this.table();
    },
    filters() {
        ['pais','ano','titular','tipo'].forEach(f=>{
            const sel=document.getElementById('filtro'+f.charAt(0).toUpperCase()+f.slice(1));
            State.unique[f+'s'].slice(0,f==='titular'?20:999).forEach(v=>{
                const opt=document.createElement('option');
                opt.value=v; opt.textContent=f==='titular'?Utils.trunc(v,40):v;
                sel.appendChild(opt);
            });
        });
    },
    table() {
        const tbody=document.getElementById('patentsTableBody');
        tbody.innerHTML='';
        const pts=State.filteredPatents;
        if(!pts.length) {
            tbody.innerHTML='<tr><td colspan="7" style="text-align:center;padding:2rem;color:#9ca3af;">Nenhuma patente</td></tr>';
            document.getElementById('resultsCount').textContent='0';
            return;
        }
        pts.forEach(p=>{
            const tr=document.createElement('tr');
            tr.onclick=()=>Modal.open(p);
            const titulo=Utils.trunc(Utils.safe(p.titulo)||'Sem t√≠tulo',60);
            const titular=Utils.trunc(Utils.safe(p.applicant)||'-',40);
            const pais=p.pais||p.country||'-';
            const ano=p.ano_deposito||p.ano||'-';
            const tipo=p.tipo_barreira||p.tipo_patente||'-';
            const ameaca=p.nivel_ameaca||'';
            let badge='<span style="color:#9ca3af;">N/A</span>';
            if(ameaca) {
                const bc=ameaca==='Alta'?'badge-alta':ameaca==='M√©dia'?'badge-media':'badge-baixa';
                badge=`<span class="badge ${bc}">${ameaca}</span>`;
            }
            tr.innerHTML=`<td><code>${Utils.trunc(p.numero_completo||p.numero||'-',20)}</code></td><td>${titulo}</td><td>${titular}</td><td style="text-align:center;">${pais}</td><td style="text-align:center;">${ano}</td><td style="text-align:center;"><span class="badge badge-tipo">${tipo}</span></td><td style="text-align:center;">${badge}</td>`;
            tbody.appendChild(tr);
        });
        document.getElementById('resultsCount').textContent=pts.length+' patentes';
    }
};
const Filters = {
    apply() {
        let f=State.allPatents;
        if(State.filters.search) {
            const n=Utils.norm(State.filters.search);
            f=f.filter(p=>Utils.norm(p.numero_completo||p.numero||'').includes(n)||Utils.norm(Utils.safe(p.titulo)).includes(n)||Utils.norm(Utils.safe(p.applicant)).includes(n));
        }
        if(State.filters.fonte) {
            f=f.filter(p=>{
                const pais=p.pais||p.country||'';
                const fonte=p.fonte||'';
                if(State.filters.fonte==='INPI') return fonte==='INPI'||pais==='BR';
                if(State.filters.fonte==='EPO') return fonte==='EPO'||(fonte!=='INPI'&&pais!=='BR'&&pais!=='');
                return true;
            });
        }
        if(State.filters.pais) f=f.filter(p=>(p.pais||p.country)===State.filters.pais);
        if(State.filters.ano) f=f.filter(p=>String(p.ano_deposito||p.ano||'')===State.filters.ano);
        if(State.filters.titular) f=f.filter(p=>Utils.safe(p.applicant)===State.filters.titular);
        if(State.filters.tipo) f=f.filter(p=>(p.tipo_barreira||p.tipo_patente)===State.filters.tipo);
        if(State.filters.ameaca) f=f.filter(p=>p.nivel_ameaca===State.filters.ameaca);
        State.filteredPatents=f;
        Render.table();
    },
    clear() {
        State.filters={search:'',fonte:'',pais:'',ano:'',titular:'',tipo:'',ameaca:''};
        document.getElementById('searchInput').value='';
        ['fonte','pais','ano','titular','tipo','ameaca'].forEach(f=>document.getElementById('filtro'+f.charAt(0).toUpperCase()+f.slice(1)).value='');
        this.apply();
    },
    setup() {
        ['fonte','pais','ano','titular','tipo','ameaca'].forEach(f=>{
            document.getElementById('filtro'+f.charAt(0).toUpperCase()+f.slice(1)).addEventListener('change',e=>{
                State.filters[f]=e.target.value; this.apply();
            });
        });
        document.getElementById('btnClearFilters').addEventListener('click',()=>this.clear());
    }
};
const Search = {
    setup() {
        const inp=document.getElementById('searchInput'), res=document.getElementById('autocompleteResults');
        inp.addEventListener('input',e=>{
            const q=e.target.value.trim();
            State.filters.search=q;
            if(q.length>=2) this.show(q); else res.classList.remove('show');
            Filters.apply();
        });
        document.addEventListener('click',e=>{if(!inp.contains(e.target)&&!res.contains(e.target)) res.classList.remove('show');});
    },
    show(q) {
        const n=Utils.norm(q);
        const r=State.allPatents.filter(p=>Utils.norm(p.numero_completo||p.numero||'').includes(n)||Utils.norm(Utils.safe(p.titulo)).includes(n)||Utils.norm(Utils.safe(p.applicant)).includes(n)).slice(0,5);
        const res=document.getElementById('autocompleteResults');
        if(!r.length) {res.classList.remove('show'); return;}
        res.innerHTML=r.map(p=>`<div class="autocomplete-item" onclick="Search.select('${p.numero_completo||p.numero}')"><strong>${p.numero_completo||p.numero}</strong><br><small>${Utils.trunc(Utils.safe(p.titulo),50)||'Sem t√≠tulo'}</small></div>`).join('');
        res.classList.add('show');
    },
    select(n) {
        document.getElementById('searchInput').value=n;
        State.filters.search=n;
        document.getElementById('autocompleteResults').classList.remove('show');
        Filters.apply();
    }
};
const Modal = {
    open(p) {
        document.getElementById('modalTitle').textContent=p.numero_completo||p.numero||'Patente';
        const titulo=Utils.safe(p.titulo)||'Sem t√≠tulo';
        const titular=Utils.safe(p.applicant)||'-';
        const abs=Utils.safe(p.abstract)||'';
        const com=Utils.safe(p.comentario_ia)||'';
        let html=`<div class="detail-item"><strong>N√∫mero</strong><p><code>${p.numero_completo||p.numero||'-'}</code></p></div>`;
        html+=`<div class="detail-item"><strong>T√≠tulo</strong><p>${titulo}</p></div>`;
        html+=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;"><div class="detail-item"><strong>Pa√≠s</strong><p>${p.pais||p.country||'-'}</p></div><div class="detail-item"><strong>Ano</strong><p>${p.ano_deposito||p.ano||'-'}</p></div></div>`;
        html+=`<div class="detail-item"><strong>Titular</strong><p>${titular}</p></div>`;
        html+=`<div class="detail-item"><strong>IPC</strong><p><code>${p.ipc||'-'}</code></p></div>`;
        if(abs&&abs!=='N/A') html+=`<div class="detail-item"><strong>Resumo</strong><p>${abs}</p></div>`;
        if(com) html+=`<div class="detail-item" style="background:#f0f9ff;padding:1rem;border-radius:0.5rem;border-left:4px solid #667eea;"><strong>üìä An√°lise IA</strong><p>${com}</p></div>`;
        document.getElementById('modalBody').innerHTML=html;
        document.getElementById('patentModal').classList.add('show');
        document.body.style.overflow='hidden';
    },
    close() {
        document.getElementById('patentModal').classList.remove('show');
        document.body.style.overflow='auto';
    },
    setup() {
        document.getElementById('patentModal').addEventListener('click',e=>{if(e.target.id==='patentModal') this.close();});
    }
};
const UI = {
    show(s) {
        document.getElementById('loadingState').classList.toggle('hidden',s!=='loading');
        document.getElementById('errorState').classList.toggle('hidden',s!=='error');
        document.getElementById('dashboardContent').classList.toggle('hidden',s!=='dash');
    },
    error(m) { this.show('error'); document.getElementById('errorMessage').textContent=m; },
    setup() {
        document.getElementById('btnNewSearch').addEventListener('click',()=>{if(confirm('Nova busca?')) {localStorage.removeItem('patentAnalysis'); window.location.href='index.html';}});
    }
};
async function init() {
    try {
        UI.show('loading');
        const data=await Loader.load();
        State.filteredPatents=State.allPatents;
        Render.dash(data);
        Search.setup();
        Filters.setup();
        Modal.setup();
        UI.setup();
        UI.show('dash');
    } catch(e) { UI.error(e.message); }
}
function closeModal() { Modal.close(); }
window.addEventListener('load',init);
    </script>
</body>
</html>
